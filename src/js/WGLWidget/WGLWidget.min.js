WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WGLWidget",function(a,b){jQuery.data(b,"obj",this);var c=this;var d=a.WT;var e=this;this._canvas=b;this._mouseWheelEventNode=b;this._mouseEventNode=b;this._keyboardEventNode=document;var f=d.glMatrix.vec3;var g=d.glMatrix.mat3;var h=d.glMatrix.mat4;this.ctx=null;this.initializeGL=function(){};this.paintGL=function(){};this.resizeGL=function(){};this.updates=new Array;this.initialized=false;this.preloadingTextures=false;c.cameraMatrix=null;var i=0;this.setManipulator=function(a){this.manipulator=a};this.getManipulator=function(){return this.manipulator};this.discoverContext=function(a){if(b.getContext){try{this.ctx=b.getContext("webgl",{antialias:true})}catch(c){}if(this.ctx==null){try{this.ctx=b.getContext("experimental-webgl")}catch(c){}}if(this.ctx==null){var d=b.firstChild;var e=b.parentNode;e.insertBefore(d,b);b.style.display="none";a()}}return this.ctx};this.setLookAtParams=function(a,b,d,e,f){this.setupManipulator();this.getManipulator().setLookFromToUp();c.cameraMatrix=a;c.timeTick()};this.setLookAtParams=function(a,b,d,e){this.setupManipulator();this.getManipulator().setLookFromToUp(b,d,e);c.cameraMatrix=a;c.timeTick()};c.timeTick=function(){if(!window.requestAnimationFrame){window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}()}c.getManipulator().update((new Date).getTime());c.cameraMatrix=c.getManipulator().getInverseMatrix();c.ctx.WtMatrix0=c.cameraMatrix;c.paintGL();window.requestAnimationFrame(c.timeTick)};this.mouseUp=function(a,b){};this.mouseDown=function(a,b){};this.mouseDragLookAt=function(a,b){};this.mouseWheelLookAt=function(a,b){};this.setupManipulator=function(a,b){if(a===undefined){a=new osgGA.OrbitManipulator}this.setManipulator(a);var c=this;var d=this;var e=function(a){for(var b=this.props.length,c;b;){c=this.props[--b];a[c]=originalEvent[c]}if(!a.target){a.target=a.srcElement||document}if(a.target.nodeType===3){a.target=a.target.parentNode}if(!a.relatedTarget&&a.fromElement){a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement}if(a.pageX===null&&a.clientX!==null){var d=document.documentElement,e=document.body;a.pageX=a.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0);a.pageY=a.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode)){a.which=a.charCode||a.keyCode}if(!a.metaKey&&a.ctrlKey){a.metaKey=a.ctrlKey}if(!a.which&&a.button!==undefined){a.which=a.button&1?1:a.button&2?3:a.button&4?2:0}return a};if(b===undefined||b===false){var f=false;var g=function(a){return d.getManipulator().touchstart(a)};var h=function(a){return d.getManipulator().touchend(a)};var i=function(a){return d.getManipulator().touchmove(a)};var j=function(a){return d.getManipulator().touchcancel(a)};var k=function(a){return d.getManipulator().touchleave(a)};var l=function(a){return d.getManipulator().gesturestart(a)};var m=function(a){return d.getManipulator().gesturechange(a)};var n=function(a){return d.getManipulator().gestureend(a)};this._canvas.addEventListener("touchstart",g,false);this._canvas.addEventListener("touchend",h,false);this._canvas.addEventListener("touchmove",i,false);this._canvas.addEventListener("touchcancel",j,false);this._canvas.addEventListener("touchleave",k,false);this._canvas.addEventListener("gesturestart",l,false);this._canvas.addEventListener("gesturechange",m,false);this._canvas.addEventListener("gestureend",n,false);var o=function(a){if(f===false){return d.getManipulator().mousedown(a)}};var p=function(a){if(f===false){return d.getManipulator().mouseup(a)}};var q=function(a){if(f===false){return d.getManipulator().mousemove(a)}};var r=function(a){if(f===false){return d.getManipulator().dblclick(a)}};var s=function(a){if(f===false){var b=a||window.event,c=[].slice.call(arguments,1),e=0,g=true,h=0,i=0;a.type="mousewheel";if(a.wheelDelta){e=a.wheelDelta/120}if(a.detail){e=-a.detail/3}i=e;if(b.axis!==undefined&&b.axis===b.HORIZONTAL_AXIS){i=0;h=-1*e}if(b.wheelDeltaY!==undefined){i=b.wheelDeltaY/120}if(b.wheelDeltaX!==undefined){h=-1*b.wheelDeltaX/120}c.unshift(a,e,h,i);var j=d.getManipulator();return j.mousewheel.apply(j,c)}};if(d.getManipulator().mousedown){this._mouseEventNode.addEventListener("mousedown",o,false)}if(d.getManipulator().mouseup){this._mouseEventNode.addEventListener("mouseup",p,false)}if(d.getManipulator().mousemove){this._mouseEventNode.addEventListener("mousemove",q,false)}if(d.getManipulator().dblclick){this._mouseEventNode.addEventListener("dblclick",r,false)}if(d.getManipulator().mousewheel){this._mouseWheelEventNode.addEventListener("DOMMouseScroll",s,false);this._mouseWheelEventNode.addEventListener("mousewheel",s,false)}var t=function(a){return d.getManipulator().keydown(a)};var u=function(a){return d.getManipulator().keyup(a)};if(d.getManipulator().keydown){this._keyboardEventNode.addEventListener("keydown",t,false)}if(d.getManipulator().keyup){this._keyboardEventNode.addEventListener("keyup",u,false)}var v=this;var w=function(a){var b=window.innerWidth;var c=window.innerHeight;var d=v._canvas.width;var e=v._canvas.height;v._canvas.width=b;v._canvas.height=c;v._canvas.style.width=b;v._canvas.style.height=c;osg.log("window resize "+d+"x"+e+" to "+b+"x"+c)};window.onresize=w}}})